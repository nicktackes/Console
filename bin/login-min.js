/*
 * Ext JS Library 3.3.1
 * Copyright(c) 2006-2010 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
Ext.onReady(function(){Ext.QuickTips.init();var j=new Ext.state.CookieProvider({});Ext.state.Manager.setProvider(j);var k=false;var e=true;var h=document.location.href.indexOf("login-debug.html")>=0;var m=false;if(document.location&&document.location.href&&document.location.href.indexOf("?")>-1){var a;if(document.location.href.indexOf("#")>-1){a=document.location.href.substring(document.location.href.indexOf("?")+1,document.location.href.indexOf("#"))}else{a=document.location.href.substring(document.location.href.indexOf("?")+1)}if(a){var d=a.split("&");if(d){for(var f=0;f<d.length;f++){var c=d[f].split("=");if(c&&c.length==2){if(c[0]=="static"&&c[1]=="true"){k=true}else{if(c[0]=="valid"&&c[1]=="false"){e=false}else{if(c[0]=="fisheye"&&c[1]=="true"){m=true}}}}}}}}var g="../../examples/console/data/login_valid.txt";var l=new Ext.FormPanel({labelWidth:80,url:g,frame:true,title:"Authentication",defaultType:"textfield",monitorValid:true,items:[{id:"alvusername",fieldLabel:"Username",name:"loginUsername",allowBlank:false},{id:"alvpassword",fieldLabel:"Password",name:"loginPassword",inputType:"password",allowBlank:false},{id:"loginStatus",name:"loginStatus",xtype:"label",hidden:true,style:" color: red;",text:"Authentication Failed.  Please try again."}],listeners:{show:function(n){var i=n.getForm().findField("alvusername");if(i){i.focus.defer(100,i,[true,true])}},afterrender:function(n){var i=n.getForm().findField("alvusername");if(i){var o=new Ext.ToolTip({html:"You can log in without requiring the mouse.  Enter your username and tab to the password field, then hit the enter key to authenticate.",title:"Tips",autoHide:true,dismissDelay:20000});o.showAt.defer(3000,o,n.getEl().getXY());i.focus.defer(100,i,[true,true])}var p=new Ext.KeyNav(n.getForm().getEl(),{enter:function(q){this.buttons[0].fireEvent("click",this.buttons[0])},scope:this})}},buttons:[{text:"Login",formBind:true,listeners:{click:function(i,n){i.handler()}},handler:function(){if(l.getForm().isValid()){l.getForm().submit({method:"POST",waitTitle:"Connecting",waitMsg:"Sending data...",success:function(p,r){var t=false;var s=Ext.util.JSON.decode(r.response.responseText);for(var o=0;o<s.users.length;o++){if(s.users[o].name==p.getValues()["loginUsername"]){Ext.util.Cookies.set("loginUsername",p.getValues()["loginUsername"]);Ext.util.Cookies.set("loginPassword",p.getValues()["loginPassword"]);t=true;break}}if(t){var q=Ext.state.Manager.get(p.getValues()["loginUsername"]+"_alvand_uistyle","windows");m=(q=="mac");var u="";u="?static="+(k?"true":"false")+"&valid="+(e?"true":"false")+"&fisheye="+(m?"true":"false");document.location.href="desktop"+(m?"-fisheye":(h?"-debug":""))+".html"+u}else{Ext.getCmp("loginStatus").show();var n=Ext.getCmp("alvusername");if(n){n.focus(true,true)}}},failure:function(n,o){var q="No details provided from the server.  Please contact your system administrator.";if(o.failureType=="server"){var p={errors:{reason:q}};if(o&&o.response&&o.response.responseText){p=Ext.util.JSON.decode(o.response.responseText)}Ext.Msg.alert("Login Failed!",(p&&p.errors&&p.errors.reason?p.errors.reason:q))}else{Ext.Msg.alert("Warning!","Authentication server is unreachable : "+(o&&o.response&&o.response.responseText?o.response.responseText:q))}var i=Ext.getCmp("alvusername");if(i){i.focus(true,true)}}})}},scope:this}]});var b=new Ext.Window({layout:"fit",width:300,height:150,closable:false,resizable:false,plain:true,border:false,modal:true,items:[l]});b.show()});